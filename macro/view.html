<script>
  // Put your actual filenames here (exactly as they exist in /img/)
  const images = [
    "widebee.jpg",
    "pistil.jpg",
    "butterfly.jpg",
    "dahlia.jpg",
    "flower.jpg",
    "bc.jpg"
  ];

  const base = "/img/"; // <-- IMPORTANT: matches your current folder

  const params = new URLSearchParams(location.search);
  const requested = params.get("i") || images[0];

  let idx = images.indexOf(requested);
  if (idx < 0) idx = 0;

  const imgEl = document.getElementById("viewerImg");
  const counter = document.getElementById("counter");
  const prevLink = document.getElementById("prevLink");
  const nextLink = document.getElementById("nextLink");

  function go(n){
    idx = (n + images.length) % images.length;

    const file = images[idx];
    imgEl.src = base + file;

    counter.textContent = `Image ${idx + 1} / ${images.length}`;

    const prevFile = images[(idx - 1 + images.length) % images.length];
    const nextFile = images[(idx + 1) % images.length];

    prevLink.href = `/macro/view.html?i=${encodeURIComponent(prevFile)}`;
    nextLink.href = `/macro/view.html?i=${encodeURIComponent(nextFile)}`;

    history.replaceState(null, "", `/macro/view.html?i=${encodeURIComponent(file)}`);
  }

  imgEl.loading = "eager";
  go(idx);

  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") go(idx - 1);
    if (e.key === "ArrowRight") go(idx + 1);
    if (e.key === "Escape") location.href = "/macro/";
  });

  document.querySelector(".prev").addEventListener("click", () => go(idx - 1));
  document.querySelector(".next").addEventListener("click", () => go(idx + 1));

  // swipe
  let x0 = null;
  document.querySelector(".viewer-frame").addEventListener("touchstart", (e) => {
    x0 = e.touches[0].clientX;
  }, {passive:true});

  document.querySelector(".viewer-frame").addEventListener("touchend", (e) => {
    if (x0 == null) return;
    const x1 = e.changedTouches[0].clientX;
    const dx = x1 - x0;
    if (Math.abs(dx) > 40) (dx > 0) ? go(idx - 1) : go(idx + 1);
    x0 = null;
  }, {passive:true});
</script>
