<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Urban Ecology — Viewer</title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body class="case">

  <header class="case-top">
    <div class="wrap case-topbar">
      <a class="case-back" href="/macro/">← Back to Urban Ecology</a>

      <div class="case-id">
        <div class="case-kicker">URBAN ECOLOGY</div>
        <div id="counter" class="case-title">Image</div>
      </div>

      <div class="case-meta">
        <a class="case-back" href="/#work">Home</a>
      </div>
    </div>
  </header>

  <main class="viewer">
    <button class="nav-btn prev" type="button" aria-label="Previous image">←</button>

    <figure class="viewer-frame">
      <img id="viewerImg" alt="Macro image" />
    </figure>

    <button class="nav-btn next" type="button" aria-label="Next image">→</button>
  </main>

  <footer class="viewer-foot">
    <a class="pill pill-light" id="prevLink" href="#">Prev</a>
    <a class="pill pill-light" id="nextLink" href="#">Next</a>
  </footer>

  <script>
    const images = [
      "bird.jpg",
      "chives.jpg",
      "dill.JPEG",
      "fern.jpg"
      "milkweed.jpg",
      "nasturtium.JPG",
      "sorrel.jpg"
    ];

    const base = "/img/";

    const params = new URLSearchParams(location.search);
    const requested = params.get("i") || images[0];

    let idx = images.indexOf(requested);
    if (idx < 0) idx = 0;

    const imgEl = document.getElementById("viewerImg");
    const counter = document.getElementById("counter");
    const prevLink = document.getElementById("prevLink");
    const nextLink = document.getElementById("nextLink");

    function go(n){
      idx = (n + images.length) % images.length;
      const file = images[idx];

      imgEl.src = base + file;
      counter.textContent = `Image ${idx + 1} / ${images.length}`;

      const prevFile = images[(idx - 1 + images.length) % images.length];
      const nextFile = images[(idx + 1) % images.length];

      prevLink.href = `/macro/view.html?i=${encodeURIComponent(prevFile)}`;
      nextLink.href = `/macro/view.html?i=${encodeURIComponent(nextFile)}`;

      history.replaceState(null, "", `/macro/view.html?i=${encodeURIComponent(file)}`);
    }

    // load first image
    imgEl.loading = "eager";
    go(idx);

    // buttons
    const prevBtn = document.querySelector(".prev");
    const nextBtn = document.querySelector(".next");
    prevBtn.addEventListener("click", () => go(idx - 1));
    nextBtn.addEventListener("click", () => go(idx + 1));

    // keyboard
    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") go(idx - 1);
      if (e.key === "ArrowRight") go(idx + 1);
      if (e.key === "Escape") location.href = "/macro/";
    });

    // swipe
    const frame = document.querySelector(".viewer-frame");
    let x0 = null;

    frame.addEventListener("touchstart", (e) => {
      x0 = e.touches[0].clientX;
    }, {passive:true});

    frame.addEventListener("touchend", (e) => {
      if (x0 == null) return;
      const x1 = e.changedTouches[0].clientX;
      const dx = x1 - x0;
      if (Math.abs(dx) > 40) (dx > 0) ? go(idx - 1) : go(idx + 1);
      x0 = null;
    }, {passive:true});
  </script>

</body>
</html>
